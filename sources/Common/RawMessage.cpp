#include "stdafx.h"
#ifndef WIN32
#include "defines.h"
#include "RawMessage.h"
#include <cstdlib>
#include <cstring>
#endif


/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
RawMessage::RawMessage(uint size) : buffer(0), allocated(0), used(0)
{
    Alloc(size);
}

//-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
RawMessage::RawMessage(uint size, uint8 value0, uint8 value1)
{
    Alloc(size);
    
    Put(value0);
    Put(value1);
}

//-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
void RawMessage::Alloc(uint size)
{
    std::free(buffer);
    allocated = 0;
    used = 0;
    buffer = (uint8 *)std::malloc(size);
    if (buffer)
    {
        allocated = size;
    }
}

//-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
RawMessage::~RawMessage()
{
    std::free(buffer);
}

//-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
void RawMessage::Put(uint8 value)
{
    buffer[used++] = value;
}

//-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
void RawMessage::Put(float value)
{
    std::memcpy(buffer + used, &value, 4);
    used += 4;
}

