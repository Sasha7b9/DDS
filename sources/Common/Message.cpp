#include "stdafx.h"
#ifndef WIN32
#include "defines.h"
#include "log.h"
#include "Message.h"
#include "Hardware/CPU.h"
#include <cstring>
#endif


/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
uint Message::transcievedPackets = 0;


/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
Message::Message()
{
    std::memset(&data, 0, sizeof(data));
}

//-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
void Message::CreateNew(uint8 *buffer, uint size)
{
    if (size <= MAX_SIZE_DATA_FIELD)
    {
        std::memcpy(DataField(), buffer, size);
        FillServiceField(size);
    }
    else
    {
        LOG_ERROR("Данные не помещаются в пакет");
    }
}

//-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
void Message::CopyFrom(const Message *packet)
{
    std::memcpy(this, packet, sizeof(Message));
}

//-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
uint8 *Message::DataField()
{
    return (uint8 *)&data.data[0];
}

//-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
void Message::FillServiceField(uint sizeData)
{
    data.numberPacket = ++transcievedPackets;
    data.size = sizeData;
}

//-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
bool Message::IsEquals(Message *rhs) const
{
    return std::memcmp((void *)&data, &rhs->data, sizeof(Data)) == 0;
}

//-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
uint8 *Message::Begin()
{
    return (uint8 *)&data;
}

//-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
uint Message::Size() const
{
    return SIZE;
}
